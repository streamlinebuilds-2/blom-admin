[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "20"

# Legacy redirects - Canonical Route Mapping (301 Permanent)
[[redirects]]
  from = "/productnew"
  to = "/products/new"
  status = 301
  force = true

[[redirects]]
  from = "/productsnew"
  to = "/products/new"
  status = 301
  force = true

[[redirects]]
  from = "/admin/productnew"
  to = "/products/new"
  status = 301
  force = true

[[redirects]]
  from = "/admin/products"
  to = "/products"
  status = 301
  force = true

[[redirects]]
  from = "/admin/products/*"
  to = "/products/:splat"
  status = 301
  force = true

[[redirects]]
  from = "/bundle-new"
  to = "/bundles/new"
  status = 301
  force = true

[[redirects]]
  from = "/special-new"
  to = "/specials/new"
  status = 301
  force = true

[[redirects]]
  from = "/orders-list"
  to = "/orders"
  status = 301
  force = true

# Catch-all admin redirect (must come after specific redirects)
[[redirects]]
  from = "/admin/*"
  to = "/:splat"
  status = 301
  force = true

# Single Page App routing (React Router / Vite) - MUST be last
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# API routes â€“ never hijack function requests
[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
